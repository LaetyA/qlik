{% extends "layouts/base.html" %}

{% block title %} Dashboard {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

{% load static %}

<div class="content">
	<div class="panel-header bg-primary-gradient">
		<div class="page-inner py-5">
			<div class="container mt-5">
				<div class="row">
					<div class="col my-2">
						<div class="dropdown dropdown-custom">
							<button class="btn btn-ligth dropdown-toggle text-dark" type="button"
								id="dropdownMenuButton2" data-bs-toggle="dropdown" aria-expanded="false">
								Actors
							</button>
							<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton2">
								<li><a class="dropdown-item" href="#">Main Actor</a></li>
								<li><a class="dropdown-item" href="#">Main Actor Type</a></li>
								<li><a class="dropdown-item" href="#">Counterparty</a></li>
							</ul>
						</div>
					</div>
					<div class="col my-2">
						<div class="dropdown dropdown-custom">
							<button class="btn btn-ligth dropdown-toggle text-dark" type="button"
								id="dropdownMenuButton3" data-bs-toggle="dropdown" aria-expanded="false">Time</button>
							<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton3">
								<li><a class="dropdown-item" href="#">Event Period</a></li>
								<li><a class="dropdown-item" href="#">Event Year</a></li>
								<li><a class="dropdown-item" href="#">Event Date</a></li>
							</ul>
						</div>
					</div>
					<div class="col my-2">
						<div class="dropdown dropdown-custom">
							<button class="btn btn-ligth dropdown-toggle text-dark" type="button"
								id="dropdownMenuButton3" data-bs-toggle="dropdown" aria-expanded="false">Events</button>
							<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton3">
								<li><a class="dropdown-item" href="#">Event Type</a></li>
								<li><a class="dropdown-item" href="#">Event Subtype</a></li>
								<li><a class="dropdown-item" href="#">Event Source</a></li>
							</ul>
						</div>
					</div>
					<div class="col my-2">
						<div class="dropdown dropdown-custom">
							<button class="btn btn-ligth dropdown-toggle text-dark" type="button"
								id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">Time</button>
							<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
								<li><a class="dropdown-item" href="#">Last Day</a></li>
								<li><a class="dropdown-item" href="#">Last 6 Days</a></li>
								<li><a class="dropdown-item" href="#">Last 30Days</a></li>
								<li><a class="dropdown-item" href="#">Last 90 Days</a></li>
								<li><a class="dropdown-item" href="#">Last Year</a></li>
								<li><a class="dropdown-item" href="#">All Dates</a></li>
								<li><a class="dropdown-item" href="#" id="openModal">Custom Date</a></li>
							</ul>
						</div>
					</div>
					<div class="col my-2">
						<div class="dropdown dropdown-custom">
							<button class="btn btn-ligth dropdown-toggle text-dark" type="button"
								id="dropdownMenuButton4" data-bs-toggle="dropdown"
								aria-expanded="false">Measure</button>
							<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton4">
								<li><a class="dropdown-item" href="#">Events</a></li>
								<li><a class="dropdown-item" href="#">Fatalities</a></li>
							</ul>
						</div>
					</div>
					<div class="col my-2">
						<div class="dropdown dropdown-custom">
							<button class="btn btn-ligth dropdown-toggle text-dark" type="button"
								id="dropdownMenuButton5" data-bs-toggle="dropdown" aria-expanded="false">Point Type
							</button>
							<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton5">
								<li><a class="dropdown-item" href="#">Icon</a></li>
								<li><a class="dropdown-item" href="#">Point</a></li>
							</ul>
						</div>
					</div>
					<div class="col my-2">
						<div class="dropdown dropdown-custom">
							<button class="btn btn-ligth dropdown-toggle text-dark" type="button"
								id="dropdownMenuButton6" data-bs-toggle="dropdown" aria-expanded="false">Map Type
							</button>
							<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton6">
								<li><a class="dropdown-item" href="#">Default</a></li>
								<li><a class="dropdown-item" href="#">Satellite</a></li>
							</ul>
						</div>
					</div>
					<div class="col my-2 ">
						<div class="dropdown dropdown-custom">
							<button class="btn btn-ligth dropdown-toggle text-dark" type="button"
								id="dropdownMenuButton7" data-bs-toggle="dropdown" aria-expanded="false">Last
								Available</button>
							<ul class="dropdown-menu" aria-labelledby="dropdownMenuButton7">
								<li><a class="dropdown-item" href="#">02/08/2023</a></li>
							</ul>
						</div>
					</div>
				</div>

				<!-- popup -->

				<div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="myModalLabel" aria-hidden="true"
					sty>
					<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
						<div class="modal-content">
							<div class="modal-header" style="color: black;">
								<h5 class="modal-title" id="myModalLabel">Select date range :</h5>
								<button type="button" class="btn-close" data-bs-dismiss="modal"
									aria-label="Fermer"></button>
							</div>
							<div class="modal-body" style="color: black;">
								<div class="row">
									<div class="col">
										<h5>start</h5>
										<input type="text" id="dateRangePicker1"
											class="form-control datepicker-input" />
									</div>
									<div class="col">
										<h5>end</h5>
										<input type="text" id="dateRangePicker2"
											class="form-control datepicker-input" />
									</div>
								</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-primary" id="btnApply">Appliquer</button>
								<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row row-card-no-pd">
		<div class="col-md-12">
			<div class="card">
				<div class="card-header">
					<div class="card-head-row card-tools-still-right">
						<h4 class="card-title">Users Geolocation</h4>
						<div class="card-tools">
							<div class="row">
								<div class="col">
									<div class="dropdown show">
										<a class="btn btn-success dropdown-toggle" href="#" role="button"
											id="continentDropdownButton" data-toggle="dropdown" aria-haspopup="true"
											aria-expanded="false">
											Select a continent
										</a>

										<div class="dropdown-menu" aria-labelledby="continentDropdownButton"
											id="continentDropdown">

											{% for continent in continentsData.continents %}
											<a class="dropdown-item continent-item" href="#"
												data-value="{{ continent.name }}">{{ continent.name }}</a>
											{% endfor %}


										</div>
									</div>
								</div>
								<div class="col">

									<div class="dropdown show" id="regionDropdownContainer" style="display: none;">
										<a class="btn btn-success dropdown-toggle" href="#" role="button"
											id="regionDropdownButton" data-toggle="dropdown" aria-haspopup="true"
											aria-expanded="false">
											Select a region
										</a>

										<div class="dropdown-menu" aria-labelledby="regionDropdownButton"
											id="regionDropdown">
											<!-- This will be populated with regions based on the selected continent -->
										</div>
									</div>
								</div>
								<div class="col">
									<!-- Menu déroulant des pays avec barre de recherche -->
									<div class="dropdown show" id="countryDropdownContainer" style="display: none;">
										<a class="btn btn-success dropdown-toggle" href="#" role="button"
											id="countryDropdownButton" data-toggle="dropdown" aria-haspopup="true"
											aria-expanded="false">
											Select a country
										</a>

										<div class="dropdown-menu" aria-labelledby="countryDropdownButton"
											id="countryDropdown">



											<!-- Liste des pays -->
											<!-- This will be populated with countries based on the selected region -->
										</div>
									</div>
								</div>

							</div>

						</div>
					</div>
					<a class="btn btn-info btn-border btn-round btn-sm mr-2" id="HeatmapBtn">
						<span class="btn-label">
							<i class="fa fa-pencil"></i>
						</span>
						Chaleur
					</a>
					<a class="btn btn-info btn-border btn-round btn-sm mr-2" id="BasemapBtn">
						<span class="btn-label">
							<i class="fa fa-pencil"></i>
						</span>
						Normal
					</a>
				</div>
				<div class="card-body">
					<div class="row">
						<div class="col-md-6">
							<div class="mapcontainer">
								<div id="map" style="width: 1180px; height: 500px;"></div>
								<div id="heatmapMap" style="width: 1180px; height: 500px; display: none;"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<br>
	<div class="page-inner mt--5">
		<div class="row mt--2">
			<div class="col-md-6">
				<div class="card full-height">
					<div class="card-body">
						<div class="card-title">Overall statistics</div>
						<div class="card-category">Daily information about statistics in system</div>
						<div class="d-flex flex-wrap justify-content-around pb-2 pt-4">
							<div class="px-2 pb-2 pb-md-0 text-center">
								<div id="circles-1"></div>
								<h6 class="fw-bold mt-3 mb-0">New Users</h6>
							</div>
							<div class="px-2 pb-2 pb-md-0 text-center">
								<div id="circles-2"></div>
								<h6 class="fw-bold mt-3 mb-0">Sales</h6>
							</div>
							<div class="px-2 pb-2 pb-md-0 text-center">
								<div id="circles-3"></div>
								<h6 class="fw-bold mt-3 mb-0">Subscribers</h6>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-6">
				<div class="card full-height">
					<div class="card-body">
						<div class="card-title">Total income & spend statistics</div>
						<div class="row py-3">
							<div class="col-md-4 d-flex flex-column justify-content-around">
								<div>
									<h6 class="fw-bold text-uppercase text-success op-8">Total Income</h6>
									<h3 class="fw-bold">$9.782</h3>
								</div>
								<div>
									<h6 class="fw-bold text-uppercase text-danger op-8">Total Spend</h6>
									<h3 class="fw-bold">$1,248</h3>
								</div>
							</div>
							<div class="col-md-8">
								<div id="chart-container">
									<canvas id="totalIncomeChart"></canvas>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-8">
				<div class="card">
					<div class="card-header">
						<div class="card-head-row">
							<div class="card-title">Event per Countries</div>
							<div class="card-tools">
								<a class="btn btn-info btn-border btn-round btn-sm mr-2" id="perCountryBtn">
									<span class="btn-label">
										<i class="fa fa-pencil"></i>
									</span>
									per Country
								</a>
								<a class="btn btn-info btn-border btn-round btn-sm mr-2" id="perPeriodBtn">
									<span class="btn-label">
										<i class="fa fa-pencil"></i>
									</span>
									per Period
								</a>
								<a class="btn btn-info btn-border btn-round btn-sm mr-2" id="perTypeSubtypeBtn">
									<span class="btn-label">
										<i class="fa fa-pencil"></i>
									</span>
									per Type&Subtype
								</a>
							</div>
						</div>
					</div>
					<div class="card-body">
						<div class="chart-container">
							<canvas id="barChart"></canvas>
							<canvas id="lineChart" style="display:none;"></canvas>
							<canvas id="bubbleChart" style="display:none;"></canvas>
						</div>

					</div>
				</div>
			</div>
			<div class="col-md-4 custom-height">
				<div class="card card-primary bg-primary-gradient">
					<div class="card-body d-flex flex-column">
						<h4 class="mt-3 b-b1 pb-2 mb-4 fw-bold">Pays</h4>
						<h1 class="mb-4 fw-bold">17</h1>
						<h4 class="mt-3 b-b1 pb-2 mb-5 fw-bold">Details Incidents</h4>
						<h4 class="mt-5 pb-3 mb-0 fw-bold">08h46-11h57</h4>
						<ul class="list-unstyled">
							<li class="d-flex justify-content-between pb-1 pt-1">
								<small>Morts</small> <span>0</span>
							</li>
							<li class="d-flex justify-content-between pb-1 pt-1">
								<small>Blessés</small> <span>38</span>
							</li>
							<li class="d-flex justify-content-between pb-1 pt-1">
								<small>Sains</small> <span>88</span>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>










		<div class="row row-card-no-pd">
			<div class="col-md-12">
				<div class="card">
					<div class="card-header">
						<div class="card-head-row card-tools-still-right">

						</div>
						<a class="btn btn-info btn-border btn-round btn-sm mr-2" id="HeatmapBtn">
							<span class="btn-label">
								<i class="fa fa-pencil"></i>
							</span>
							Chaleur
						</a>
						<a class="btn btn-info btn-border btn-round btn-sm mr-2" id="BasemapBtn">
							<span class="btn-label">
								<i class="fa fa-pencil"></i>
							</span>
							Normal
						</a>
					</div>
					<div class="card-body">
						<div class="page-inner mt--5">
							<!-- debut de la section de travail graphe -->
							<div class="row mt--2">
								<!-- debut graphe1-->
								<div class="col-md-6">
									<div class="card full-height">
										<div class="card-body">
											<div class="card-title">Total Event Per Period</div>
											<canvas id="barCanvas" aria-label="Event_period" role="img"></canvas>
										</div>
									</div>
								</div>
								<!-- debut graphe2-->

								<div class="col-md-6">
									<div class="card full-height">
										<div class="card-body">
											<div class="card-title">
												<div class="row">
													<div class="col-md-8">
														Total Events per type & subtype
													</div>
													<div class="col-md-4 col-md-4-hidden"
														style="background-color: white;">
														<div class="row">
															<div class="col-md-3">&#x1F4E2;</div>
															<div class="col-md-3">&#x1F4E2;</div>
															<div class="col-md-3">&#x1F4E2;</div>
															<div class="col-md-3">&#x1F4E2;</div>
														</div>
													</div>

												</div>

											</div>

										</div>
										<canvas id="EventTypeCanvas" aria-label="Events_type" role="img"></canvas>
										<div class="row">
											<div class="col-md-4 d-flex align-items-center">
												<div class="legend-box" style="background-color:#FFFF00;"></div>
												<p class="ml-2 mb-0" style="color: white;">Battles</p>
											</div>

											<div class="col-md-4 d-flex align-items-center">
												<div class="legend-box" style="background-color: #00FFFF;"></div>
												<p class="ml-2 mb-0" style="color: white;">Protests</p>
											</div>
											<div class="col-md-4 d-flex align-items-center">
												<div class="legend-box" style="background-color: #7A238A;"></div>
												<p class="ml-2 mb-0" style="color: white;">Strategic developments</p>
											</div>
										</div>
										<div class="row">
											<div class="col-md-4 d-flex align-items-center">
												<div class="legend-box" style="background-color: #D473D4;"></div>
												<p class="ml-2 mb-0" style="font-size: 11px;color: white;">
													Explosions/remote
													violences
												</p>
											</div>
											<div class="col-md-4 d-flex align-items-center">
												<div class="legend-box" style="background-color: #FA8072;"></div>
												<p class="ml-2 mb-0" style="color: white;">Riots</p>
											</div>
											<div class="col-md-4 d-flex align-items-center">
												<div class="legend-box" style="background-color:#FFC961;"></div>
												<p class="ml-2 mb-0" style="font-size: 13px;color: white;">Violence
													against
													civilians
												</p>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>






































		<div class="row">
			<div class="col-md-4">
				<div class="card">
					<div class="card-header">
						<div class="card-title">Top Products</div>
					</div>
					<div class="card-body pb-0">
						<div class="d-flex">
							<div class="avatar">
								<img src="/static/assets/img/logoproduct.svg" alt="..."
									class="avatar-img rounded-circle">
							</div>
							<div class="flex-1 pt-1 ml-2">
								<h6 class="fw-bold mb-1">CSS</h6>
								<small class="text-muted">Cascading Style Sheets</small>
							</div>
							<div class="d-flex ml-auto align-items-center">
								<h3 class="text-info fw-bold">+$17</h3>
							</div>
						</div>
						<div class="separator-dashed"></div>
						<div class="d-flex">
							<div class="avatar">
								<img src="/static/assets/img/logoproduct.svg" alt="..."
									class="avatar-img rounded-circle">
							</div>
							<div class="flex-1 pt-1 ml-2">
								<h6 class="fw-bold mb-1">J.CO Donuts</h6>
								<small class="text-muted">The Best Donuts</small>
							</div>
							<div class="d-flex ml-auto align-items-center">
								<h3 class="text-info fw-bold">+$300</h3>
							</div>
						</div>
						<div class="separator-dashed"></div>
						<div class="d-flex">
							<div class="avatar">
								<img src="/static/assets/img/logoproduct3.svg" alt="..."
									class="avatar-img rounded-circle">
							</div>
							<div class="flex-1 pt-1 ml-2">
								<h6 class="fw-bold mb-1">Ready Pro</h6>
								<small class="text-muted">Bootstrap 4 Admin Dashboard</small>
							</div>
							<div class="d-flex ml-auto align-items-center">
								<h3 class="text-info fw-bold">+$350</h3>
							</div>
						</div>
						<div class="separator-dashed"></div>
						<div class="pull-in">
							<canvas id="topProductsChart"></canvas>
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-4">
				<div class="card">
					<div class="card-body">
						<div class="card-title fw-mediumbold">Suggested People</div>
						<div class="card-list">
							<div class="item-list">
								<div class="avatar">
									<img src="/static/assets/img/jm_denis.jpg" alt="..."
										class="avatar-img rounded-circle">
								</div>
								<div class="info-user ml-3">
									<div class="username">Jimmy Denis</div>
									<div class="status">Graphic Designer</div>
								</div>
								<button class="btn btn-icon btn-primary btn-round btn-xs">
									<i class="fa fa-plus"></i>
								</button>
							</div>
							<div class="item-list">
								<div class="avatar">
									<img src="/static/assets/img/chadengle.jpg" alt="..."
										class="avatar-img rounded-circle">
								</div>
								<div class="info-user ml-3">
									<div class="username">Chad</div>
									<div class="status">CEO Zeleaf</div>
								</div>
								<button class="btn btn-icon btn-primary btn-round btn-xs">
									<i class="fa fa-plus"></i>
								</button>
							</div>
							<div class="item-list">
								<div class="avatar">
									<img src="/static/assets/img/talha.jpg" alt="..." class="avatar-img rounded-circle">
								</div>
								<div class="info-user ml-3">
									<div class="username">Talha</div>
									<div class="status">Front End Designer</div>
								</div>
								<button class="btn btn-icon btn-primary btn-round btn-xs">
									<i class="fa fa-plus"></i>
								</button>
							</div>
							<div class="item-list">
								<div class="avatar">
									<img src="/static/assets/img/mlane.jpg" alt="..." class="avatar-img rounded-circle">
								</div>
								<div class="info-user ml-3">
									<div class="username">John Doe</div>
									<div class="status">Back End Developer</div>
								</div>
								<button class="btn btn-icon btn-primary btn-round btn-xs">
									<i class="fa fa-plus"></i>
								</button>
							</div>
							<div class="item-list">
								<div class="avatar">
									<img src="/static/assets/img/talha.jpg" alt="..." class="avatar-img rounded-circle">
								</div>
								<div class="info-user ml-3">
									<div class="username">Talha</div>
									<div class="status">Front End Designer</div>
								</div>
								<button class="btn btn-icon btn-primary btn-round btn-xs">
									<i class="fa fa-plus"></i>
								</button>
							</div>
							<div class="item-list">
								<div class="avatar">
									<img src="/static/assets/img/jm_denis.jpg" alt="..."
										class="avatar-img rounded-circle">
								</div>
								<div class="info-user ml-3">
									<div class="username">Jimmy Denis</div>
									<div class="status">Graphic Designer</div>
								</div>
								<button class="btn btn-icon btn-primary btn-round btn-xs">
									<i class="fa fa-plus"></i>
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-4">
				<div class="card card-primary">
					<div class="card-header">
						<div class="card-title">Daily Sales</div>
						<div class="card-category">March 25 - April 02</div>
					</div>
					<div class="card-body pb-0">
						<div class="mb-4 mt-2">
							<h1>$4,578.58</h1>
						</div>
						<div class="pull-in">
							<canvas id="dailySalesChart"></canvas>
						</div>
					</div>
				</div>
				<div class="card">
					<div class="card-body pb-0">
						<div class="h1 fw-bold float-right text-warning">+7%</div>
						<h2 class="mb-2">213</h2>
						<p class="text-muted">Transactions</p>
						<div class="pull-in sparkline-fix">
							<div id="lineChart"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-6">
				<div class="card full-height" id="event-card">
					<div class="card-header">
						<div class="card-title">
							<div class="row align-items-center">
								<!-- Colonne "Last Events" -->
								<div class="col-md-3">
									<span>Last Events</span>
								</div>
								<!-- Colonne de la barre de recherche -->
								<div class="col-md-9">
									<div class="input-group">
										<input type="text" class="form-control" id="search-bar"
											placeholder="Rechercher..." aria-haspopup="true" aria-expanded="false"
											data-toggle="dropdown">
										<div class="input-group-append">
											<button class="btn btn-outline-secondary dropdown-toggle" type="button"
												data-toggle="dropdown" aria-haspopup="true"
												aria-expanded="false"></button>
											<div class="dropdown-menu" aria-labelledby="search-bar">
												<div id="dropdown-options"></div>
											</div>


										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="card-body-scroll">
						<div class="container mt-5">
							<!-- Contenu du corps de la carte -->
							<ol class="activity-feed" id="activity-feed">
								<!-- Les données récupérées via AJAX seront affichées ici -->
							</ol>
						</div>
					</div>
				</div>
				<div id="replace">

				</div>



			</div>
			<div class="col-md-6">
				<div class="card full-height">
					<div class="card-header">
						<div class="card-head-row">
							<div class="card-title">Commentaires</div>
							<div class="card-tools">
								<div class="form-group">
									<div class="input-icon">
										<input id="commentSearch" type="text" class="form-control"
											placeholder="Search for...">
										<span class="input-icon-addon">
											<i class="fa fa-search"></i>
										</span>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- Boucle pour afficher les commentaires -->

					<div class="card-body comment" id="commentsContainer">
						<!-- Boucle pour afficher les commentaires -->
						{% for comment in comments reversed %}
						<div class="d-flex mb-2 comment-entry">
							<!-- Avatar de l'utilisateur -->
							<div class="avatar avatar-online">
								<span class="avatar-title rounded-circle border border-white random-color">
									{{ comment.get_username|slice:"1" }}</span>
							</div>
							<!-- Contenu du commentaire -->
							<div class="flex-1 ml-3 pt-1" style="color: white;">
								<h6 class="text-uppercase fw-bold mb-1">
									{{ comment.get_username }}
									{{ comment.user.first_name }}
									{{ comment.user.last_name }}</h6>
								<span class="text-muted" style="color: white !important;">{{ comment.text }}</span>
							</div>
							<!-- Heure du commentaire -->
							<div class="float-right pt-1">
								<small class="text-muted" style="color: white !important;">{{ comment.date|date:"G:i / j M Y " }}</small>
							</div>
						</div>
						<div class="separator-dashed"></div>
						{% endfor %}
					</div>

					<br>
					<div class="container" style="text-align: center;" id="postButton">
						<button class="btn btn-secondary mt-3" style="height: 45px; width: 130px; ">
							<span class="btn-label">
								<i class="fa fa-plus"></i>
							</span>
							Post
						</button>
					</div>


					<!-- Affichez le formulaire pour poster un commentaire -->
					<form id="commentForm" method="post" class="hidden-form">
						{% csrf_token %}
						<textarea id="commentText" name="text" class="form-control" rows="3"
							placeholder="Write a comment..."></textarea>
						<div class="container" style="text-align: center;" id="postButtonContainer">
							<div class="card-action">
								<button type="button" class="btn btn-danger mr-2" id="cancelButton">Annuler</button>
								<button type="button" class="btn btn-success" id="submitCommentBtn">Valider</button>
							</div>
						</div>

					</form>

				</div>
			</div>
		</div>
	</div>
</div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

<!-- Atlantis DEMO methods, don't include it in your project! -->
<script src="/static/assets/js/setting-demo.js"></script>
<script src="/static/assets/js/demo.js"></script>
<script src="https://api.mapbox.com/mapbox-gl-js/v2.5.1/mapbox-gl.js"></script>
<script src="https://unpkg.com/mapbox-gl@2.4.1/dist/mapbox-gl.js"></script>



<link href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css" rel="stylesheet" />
<link rel="stylesheet" href="https://unpkg.com/mapbox-gl@2.4.1/dist/mapbox-gl.css" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>


<style>
	/* CSS personnalisé pour afficher la liste des pays en dessous du bouton */
	.dropdown-menu {
		max-height: 200px;
		overflow-y: auto;
		/*top: 100% !important;
		margin-top: 171px !important;*/
	}

	.dropdown-menu .dropdown-item {
		/* Retirez ou désactivez la règle de filter */
		/* filter: blur(2px); */
		/* Ou réglez la valeur sur none */
		filter: none;
	}

	.chart-container {
		height: 350px;
	}

	.custom-height {
		height: 350px;
	}

	.popup {
		background-color: white;
		/*border: 1px solid #ddd;*/
		padding: 0px;
		display: flex;
		position: absolute;
		top: 0;
		right: 0;
		border-radius: 5px;
	}

	.popup i {
		margin: 0 5px;
		cursor: pointer;
	}

	.hidden-form {
		display: none;
	}

	.comment {
		max-height: 310px;
		overflow-y: auto;
	}

	.comment-highlight {
		background-color: red;
	}



	.card-body-scroll {
		overflow: auto;
		/* Défilement automatique lorsque le contenu dépasse */
		max-height: 500px;
		/* Hauteur maximale du div avec défilement */
	}

	.col-md-4-hidden {
		display: none;
	}

	.legend-box {
		width: 20px;
		height: 20px;
		border: 1px solid #ccc;
		display: inline-block;
		vertical-align: middle;
		margin-right: 5px;
	}

	/* style de la plus grande chart*/

	.chart-grand {
		height: 500px;
		/* Vous pouvez ajuster la hauteur souhaitée ici */
	}

	/* Additional styles for the modal */
	.modal-dialog {
		max-width: 300px;
		/* Reduce the modal width */
		bottom: 100px;
	}

	.modal-content {
		max-height: 400px;
		/* Adjust the modal content height */
		overflow-y: auto;
		/* Enable vertical scroll if content overflows */
	}

	/* Positionnement personnalisé pour la fenêtre modale */
	.modal-bottom {
		margin-top: 50px;
		/* Ajuster l'espace entre le dropdown et la fenêtre modale */
		margin-right: 50px;
	}

	/* Styles personnalisés pour les dropdowns */
	.dropdown-custom .btn {
		background-color: #ffffff;
		/* Couleur de fond blanche */
		color: #000000;
		/* Couleur du texte en noir */
		width: 130px;
		/* Largeur du dropdown */
	}

	.dropdown-custom .btn:hover,
	.dropdown-custom .btn:focus {
		background-color: #f2f2f2;
		/* Couleur de fond au survol ou au focus */
	}

	.dropdown-custom .dropdown-menu {
		background-color: #ffffff;
		/* Couleur de fond blanche pour la liste déroulante */
		width: 10px;
		/* Même largeur que le dropdown */
	}

	.dropdown-custom .dropdown-item {
		color: #000000;
		/* Couleur du texte en noir pour les éléments de la liste déroulante */
	}

	.dropdown-custom .dropdown-item:hover,
	.dropdown-custom .dropdown-item:focus {
		background-color: #f2f2f2;
		/* Couleur de fond au survol ou au focus des éléments de la liste déroulante */
	}

	/* Ajuster la largeur des boutons */
	.btn-custom-width {
		width: 150px;
		/* Vous pouvez ajuster cette valeur selon vos besoins */
	}

	/* Ajuster la liste déroulante à la largeur du bouton déclencheur */
	.dropdown.show .dropdown-menu {
		width: 100% !important;
	}
</style>

<script>
	Circles.create({
		id: 'circles-1',
		radius: 45,
		value: 60,
		maxValue: 100,
		width: 7,
		text: 5,
		colors: ['#f1f1f1', '#FF9E27'],
		duration: 400,
		wrpClass: 'circles-wrp',
		textClass: 'circles-text',
		styleWrapper: true,
		styleText: true
	})

	Circles.create({
		id: 'circles-2',
		radius: 45,
		value: 70,
		maxValue: 100,
		width: 7,
		text: 36,
		colors: ['#f1f1f1', '#2BB930'],
		duration: 400,
		wrpClass: 'circles-wrp',
		textClass: 'circles-text',
		styleWrapper: true,
		styleText: true
	})

	Circles.create({
		id: 'circles-3',
		radius: 45,
		value: 40,
		maxValue: 100,
		width: 7,
		text: 12,
		colors: ['#f1f1f1', '#F25961'],
		duration: 400,
		wrpClass: 'circles-wrp',
		textClass: 'circles-text',
		styleWrapper: true,
		styleText: true
	})

	var totalIncomeChart = document.getElementById('totalIncomeChart').getContext('2d');

	var mytotalIncomeChart = new Chart(totalIncomeChart, {
		type: 'bar',
		data: {
			labels: ["S", "M", "T", "W", "T", "F", "S", "S", "M", "T"],
			datasets: [{
				label: "Total Income",
				backgroundColor: '#ff9e27',
				borderColor: 'rgb(23, 125, 255)',
				data: [6, 4, 9, 5, 4, 6, 4, 3, 8, 10],
			}],
		},
		options: {
			responsive: true,
			maintainAspectRatio: false,
			legend: {
				display: false,
			},
			scales: {
				yAxes: [{
					ticks: {
						display: false //this will remove only the label
					},
					gridLines: {
						drawBorder: false,
						display: false
					}
				}],
				xAxes: [{
					gridLines: {
						drawBorder: false,
						display: false
					}
				}]
			},
		}
	});

	$('#lineChart').sparkline([105, 103, 123, 100, 95, 105, 115], {
		type: 'line',
		height: '70',
		width: '100%',
		lineWidth: '2',
		lineColor: '#ffa534',
		fillColor: 'rgba(255, 165, 52, .14)'
	});

	var lineChart = document.getElementById('lineChart').getContext('2d'),
		bubbleChart = document.getElementById('bubbleChart').getContext('2d')


	var myLineChart = new Chart(lineChart, {
		type: 'line',
		data: {
			labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
			datasets: [{
				label: "Active Users",
				borderColor: "#1d7af3",
				pointBorderColor: "#FFF",
				pointBackgroundColor: "#1d7af3",
				pointBorderWidth: 2,
				pointHoverRadius: 4,
				pointHoverBorderWidth: 1,
				pointRadius: 4,
				backgroundColor: 'transparent',
				fill: true,
				borderWidth: 2,
				data: [542, 480, 430, 550, 530, 453, 380, 434, 568, 610, 700, 900]
			}]
		},
		options: {
			responsive: true,
			maintainAspectRatio: false,
			legend: {
				position: 'bottom',
				labels: {
					padding: 10,
					fontColor: '#1d7af3',
				}
			},
			tooltips: {
				bodySpacing: 4,
				mode: "nearest",
				intersect: 0,
				position: "nearest",
				xPadding: 10,
				yPadding: 10,
				caretPadding: 10
			},
			layout: {
				padding: { left: 15, right: 15, top: 15, bottom: 15 }
			}
		}
	});

	var myBubbleChart = new Chart(bubbleChart, {
		type: 'bubble',
		data: {
			datasets: [{
				label: "Car",
				data: [{ x: 25, y: 17, r: 25 }, { x: 30, y: 25, r: 28 }, { x: 35, y: 30, r: 8 }],
				backgroundColor: "#716aca"
			},
			{
				label: "Motorcycles",
				data: [{ x: 10, y: 17, r: 20 }, { x: 30, y: 10, r: 7 }, { x: 35, y: 20, r: 10 }],
				backgroundColor: "#1d7af3"
			}],
		},
		options: {
			responsive: true,
			maintainAspectRatio: false,
			legend: {
				position: 'bottom'
			},
			scales: {
				yAxes: [{
					ticks: {
						beginAtZero: true
					}
				}],
				xAxes: [{
					ticks: {
						beginAtZero: true
					}
				}]
			},
		}
	});


	// Gérer le clic sur le bouton "per Country"
	$("#perCountryBtn").on("click", function () {
		// Afficher le graphique "barChart" et masquer les autres graphiques
		$("#barChart").show();
		$("#lineChart").hide();
		$("#bubbleChart").hide();
	});

	// Gérer le clic sur le bouton "per Period"
	$("#perPeriodBtn").on("click", function () {
		// Afficher le graphique "lineChart" et masquer les autres graphiques
		$("#barChart").hide();
		$("#lineChart").show();
		$("#bubbleChart").hide();
	});

	// Gérer le clic sur le bouton "per Type&Subtype"
	$("#perTypeSubtypeBtn").on("click", function () {
		// Afficher le graphique "bubbleChart" et masquer les autres graphiques
		$("#barChart").hide();
		$("#lineChart").hide();
		$("#bubbleChart").show();
	});

	// Afficher le graphique "barChart" par défaut
	$("#barChart").show();



	// Masquer la carte de chaleur et afficher la carte de base
	/*document.querySelector('.mapcontainer #heatmapMap').style.display = 'none';
	document.querySelector('.mapcontainer #map').style.display = 'block';*/


	// Gérer le clic sur le bouton "per Country"
	$("#BasemapBtn").on("click", function () {
		// Afficher le graphique "barChart" et masquer les autres graphiques
		$("#map").show();
		$("#heatmapMap").hide();
	});

	// Afficher le graphique "barChart" par défaut
	$("#map").show();




	mapboxgl.accessToken = 'pk.eyJ1IjoidHJpZ2dlcnMiLCJhIjoiY2wxMjNxYmkwMDM2ZjNpbXZvMXNqaXRwcyJ9.CPlAR38urDrvZeJOIUERIw';
	var map = new mapboxgl.Map({
		container: 'map',
		style: 'mapbox://styles/mapbox/streets-v11',
		center: [-5.5471, 7.5468545], // Remplacez par les coordonnées du centre de votre carte
		zoom: 5,// Niveau de zoom initial
		maxZoom: 15
	});


	var heatmapMap = new mapboxgl.Map({
		container: 'heatmapMap',
		style: 'mapbox://styles/mapbox/light-v10',
		center: [-5.5471, 7.5468545], // Remplacez par les coordonnées du centre de votre carte
		zoom: 5,// Niveau de zoom initial
		maxZoom: 15
	});

	var geolocateControl = new mapboxgl.GeolocateControl({ // Utilisation de this.geolocateControl
		positionOptions: {
			enableHighAccuracy: true
		},
		trackUserLocation: true,
		showUserHeading: true
	});

	var geolocateHeatControl = new mapboxgl.GeolocateControl({ // Utilisation de this.geolocateControl
		positionOptions: {
			enableHighAccuracy: true
		},
		trackUserLocation: true,
		showUserHeading: true
	});

	map.addControl(this.geolocateControl, 'top-left');
	heatmapMap.addControl(this.geolocateHeatControl, 'top-left');

	var heatmapData = [
		{ lng: 13.404954, lat: 52.520008, value: 0.6 }, // Berlin, Germany
		{ lng: 2.352222, lat: 48.856614, value: 0.7 }, // Paris, France
		{ lng: -0.180525, lat: 51.404818, value: 0.9 }, // London, United Kingdom
		{ lng: 4.351710, lat: 50.850340, value: 0.8 }, // Brussels, Belgium
		{ lng: 12.496366, lat: 41.902782, value: 0.4 }, // Rome, Italy
		{ lng: 31.235712, lat: 30.044420, value: 0.3 }, // Cairo, Egypt
		{ lng: 2.173403, lat: 41.385064, value: 0.5 }, // Barcelona, Spain
		{ lng: 32.585179, lat: 15.500654, value: 0.2 }, // Khartoum, Sudan
		{ lng: 35.689506, lat: 139.691700, value: 0.7 }, // Tokyo, Japan
		{ lng: 25.276987, lat: -25.731340, value: 0.6 }, // Johannesburg, South Africa
		{ lng: 5.603717, lat: 52.076665, value: 0.8 }, // Amsterdam, Netherlands
		{ lng: -8.629105, lat: 41.157944, value: 0.4 }, // Porto, Portugal
		// Ajoutez plus de points avec leurs coordonnées et valeurs ici
	];



	heatmapMap.on('load', function () {
		// Ajouter la couche de chaleur à la carte de chaleur
		heatmapMap.addLayer({
			id: 'heatmapLayer',
			type: 'heatmap',
			source: {
				type: 'geojson',
				data: {
					type: 'FeatureCollection',
					features: heatmapData.map(point => ({
						type: 'Feature',
						geometry: {
							type: 'Point',
							coordinates: [point.lng, point.lat]
						},
						properties: {
							value: point.value
						}
					}))
				}
			},
			paint: {
				'heatmap-radius': 20,
				'heatmap-color': [
					'interpolate',
					['linear'],
					['heatmap-density'],
					0, 'rgba(33,102,172,0)',
					0.2, 'rgb(103,169,207)',
					0.4, 'rgb(209,229,240)',
					0.6, 'rgb(253,219,199)',
					0.8, 'rgb(239,138,98)',
					1, 'rgb(178,24,43)'
				],
				'heatmap-opacity': 0.75
			}
		});
	});

	document.getElementById('HeatmapBtn').addEventListener('click', function () {
		// Masquer la carte existante et afficher la carte de chaleur
		document.querySelector('.mapcontainer #map').style.display = 'none';
		document.querySelector('.mapcontainer #heatmapMap').style.display = 'block';

		// Redimensionner la carte de chaleur pour s'adapter à la taille du conteneur
		heatmapMap.resize();
	});





	// Déclarez la variable continentsData en dehors de la fonction loadJSON
	let continentsData

	// Fonction pour charger les données JSON depuis pays.json via une requête AJAX
	function loadJSON(callback) {
		const xhr = new XMLHttpRequest();
		xhr.overrideMimeType("application/json");
		xhr.open("GET", "{% static 'json/pays.json' %}", true);
		xhr.onreadystatechange = function () {
			if (xhr.readyState === 4 && xhr.status === 200) {
				continentsData = JSON.parse(xhr.responseText);
				callback(continentsData); // Appelez la fonction de rappel avec les données JSON en tant qu'argument
			}
		};
		xhr.send(null);
	}

	let selectedMarker;
	// Utilisez la fonction loadJSON pour récupérer les données JSON
	loadJSON(function (data) {
		// Ici, vous pouvez utiliser les données JSON récupérées
		console.log(data);

		// Placez le reste de votre code ici, en utilisant les données JSON

		// Récupérer les éléments des menus déroulants
		// Récupérer les éléments des menus déroulants
		const continentDropdown = $("#continentDropdown");
		const regionDropdownContainer = $("#regionDropdownContainer");
		const regionDropdown = $("#regionDropdown");
		const countryDropdownContainer = $("#countryDropdownContainer");
		const countryDropdown = $("#countryDropdown");

		// Gérer le changement de sélection dans le menu déroulant des continents
		continentDropdown.on("click", ".continent-item", function (e) {
			e.preventDefault();

			// Récupérer le continent sélectionné
			const selectedContinent = $(this).data("value");

			// Afficher le continent sélectionné dans le bouton du menu déroulant
			$("#continentDropdownButton").text(selectedContinent);

			// Masquer le menu déroulant des pays
			countryDropdownContainer.hide();
			countryDropdown.empty();

			// Masquer le menu déroulant des régions (au cas où l'utilisateur change de continent)
			regionDropdownContainer.hide();
			regionDropdown.empty();

			// Récupérer les régions du continent sélectionné
			const regions = data.continents.find(continent => continent.name === selectedContinent).regions;

			// Remplir le menu déroulant des régions
			regions.forEach(region => {
				const optionElement = `<a class="dropdown-item region-item" href="#" data-value="${region.name}">${region.name}</a>`;
				regionDropdown.append(optionElement);
			});

			// Afficher le menu déroulant des régions
			regionDropdownContainer.show();
		});

		var selectedBars = new Set(); // Utilisez un ensemble pour stocker les indices des barres sélectionnées

		var dataChart = {
			labels: [], // Utilisez les noms des pays comme valeurs de l'axe des ordonnées
			datasets: [{
				label: "Incidents",
				backgroundColor: 'rgb(23, 125, 255)',
				borderColor: 'rgb(23, 125, 255)',
				data: [], // Utilisez les valeurs des incidents comme données pour le graphique à barres
			}]
		};

		var options = {
			responsive: true,
			maintainAspectRatio: false,
			scales: {
				xAxes: [{
					ticks: {
						beginAtZero: true
					}
				}]
			},

			onClick: function (event, elements) {
				if (elements && elements.length > 0) {
					var elementIndex = elements[0]._index; // Index de la barre cliquée

					// Vérifiez si la barre est déjà sélectionnée
					if (selectedBars.has(elementIndex)) {
						// La barre est déjà sélectionnée, donc la désélectionner
						selectedBars.delete(elementIndex);
					} else {
						// La barre n'est pas déjà sélectionnée, donc l'ajouter à la sélection
						selectedBars.add(elementIndex);
					}

					// Mettre à jour les couleurs en fonction des barres sélectionnées
					var meta = myBarChart.getDatasetMeta(0);
					meta.data.forEach(function (bar, i) {
						if (selectedBars.has(i)) {
							bar._model.backgroundColor = 'green';
						} else {
							bar._model.backgroundColor = 'rgb(23, 125, 255)';
						}
					});

					// Mettez à jour le graphique pour refléter les changements
					myBarChart.update();

					// Créez le popup avec les boutons ici
					var popup = document.createElement("div");
					popup.className = "popup";

					// Créez le groupe de boutons avec les icônes
					popup.innerHTML = `
                <div class="btn-group btn-group-toggle" data-toggle="buttons">
                    <label class="btn btn-secondary btn-sm active">
                        <input type="radio" name="options" id="option1" autocomplete="off">
                        <i class="fas fa-plus-circle"></i>
                    </label>
                    <label class="btn btn-secondary btn-sm">
                        <input type="radio" name="options" id="option2" autocomplete="off">
                        <i class="far fa-times-circle"></i>
                    </label>
                    <label class="btn btn-secondary btn-sm">
                        <input type="radio" name="options" id="option3" autocomplete="off">
                        <i class="fas fa-check"></i>
                    </label>
                    <label class="btn btn-secondary btn-sm">
                        <input type="radio" name="options" id="option4" autocomplete="off">
                        <i class="fas fa-times"></i>
                    </label>
                </div>
            `;

					// Ajoutez le popup à l'intérieur de la div avec la classe "chart-container"
					var chartContainer = document.querySelector(".chart-container");
					chartContainer.appendChild(popup);

					// Positionnez le popup en haut à droite de la div "chart-container"
					popup.style.position = "absolute";
					popup.style.right = "0";
					popup.style.top = "0";

					// Supprimez le popup lorsque le bouton "x" est cliqué
					var closeButton = popup.querySelector(".btn-secondary:last-child");
					closeButton.addEventListener("click", function () {
						chartContainer.removeChild(popup);
					});
				}
			}
		};

		var myBarChart = new Chart(barChart, {
			type: 'horizontalBar', // Utilisez le type horizontalBar pour avoir un histogramme horizontal
			data: dataChart,
			options: options
		});






		// Gérer le changement de sélection dans le menu déroulant des régions
		regionDropdown.on("click", ".region-item", function (e) {
			e.preventDefault();

			// Récupérer la région sélectionnée
			const selectedRegion = $(this).data("value");

			// Afficher la région sélectionnée dans le bouton du menu déroulant
			$("#regionDropdownButton").text(selectedRegion);

			// Masquer le menu déroulant des pays (au cas où l'utilisateur change de région)
			countryDropdownContainer.hide();
			countryDropdown.empty();

			// Récupérer les pays de la région sélectionnée
			const continent = data.continents.find(continent => continent.name === $("#continentDropdownButton").text());
			const countries = continent.regions.find(region => region.name === selectedRegion).countries;

			// Créer l'élément de la barre de recherche
			const searchInputElement = $('<input type="text" class="form-control search-input" placeholder="Search country...">')

				.css({
					"border-top": "0px",
					"border-bottom": "3px solid gray",
					"border-left": "0px",
					"border-right": "0px",
					"background": "white",
					"border-radius": "25px",
					"color": "black",
					"height": "40px",
				})
				// Ajouter l'événement onkeyup à la barre de recherche
				.on("keyup", function () {
					filterDropdownItems(this, 'country-item');
				});

			// Ajouter la barre de recherche au début du dropdown-menu des pays
			countryDropdown.prepend(searchInputElement);

			// Remplir le menu déroulant des pays
			countries.forEach(country => {
				const optionElement = `<a class="dropdown-item country-item" href="#" data-value="${country.name}" data-lat="${country.latitude}" data-lon="${country.longitude}">${country.name}</a>`;
				countryDropdown.append(optionElement);
			});


			// Afficher le menu déroulant des pays
			countryDropdownContainer.show();

			// Mettre à jour l'objet "data" avec les valeurs des pays et des incidents
			const countryNames = countries.map(country => country.name);
			const incidentValues = countries.map(country => Math.floor(Math.random() * 100)); // Valeurs aléatoires entre 0 et 100
			myBarChart.data.labels = countryNames;
			myBarChart.data.datasets[0].data = incidentValues;
			myBarChart.update(); // Mettre à jour le graphique


		});

		countryDropdown.on("click", ".country-item", function (e) {
			e.preventDefault();

			// Récupérer le pays sélectionné
			const selectedCountry = $(this).data("value");
			const lat = $(this).data("lat");
			const lon = $(this).data("lon");

			// Afficher le pays sélectionné dans le bouton du menu déroulant
			$("#countryDropdownButton").text(selectedCountry);

			// Déplacer la carte Mapbox pour centrer le pays sélectionné
			map.flyTo({ center: [lon, lat], zoom: 5 });

			heatmapMap.flyTo({ center: [lon, lat], zoom: 5 });


			function loadCountryGeoJSON(map, countryName) {
				// Charger les données GeoJSON des contours du pays ici
				// Remplacez 'path/to/' par le chemin vers le dossier contenant les fichiers GeoJSON de chaque pays
				const geoJSONPath = `/static/geojson/${countryName}.geojson`;

				// Vérifier si la source de données existe déjà
				const sourceExists = map.getSource('countries');

				if (sourceExists) {
					// Mettre à jour la source de données existante avec le nouveau fichier GeoJSON
					map.getSource('countries').setData(geoJSONPath);
				} else {
					// Ajouter une nouvelle source de données pour le pays sélectionné
					map.addSource('countries', {
						type: 'geojson',
						data: geoJSONPath,
					});

					// Ajouter une couche de remplissage pour le pays
					map.addLayer({
						id: 'country-fill',
						type: 'fill',
						source: 'countries',
						paint: {
							'fill-color': 'blue', // Couleur de remplissage des pays
							'fill-opacity': 0.5, // Opacité de remplissage
						},
					});

					// Ajouter une couche de contour pour le pays
					/*map.addLayer({
						id: 'country-outline',
						type: 'line',
						source: 'countries',
						paint: {
							'line-color': 'red', // Couleur des contours des pays
							'line-width': 1, // Epaisseur des contours
						},
					});*/
				}
			}

			loadCountryGeoJSON(map, selectedCountry);
			loadCountryGeoJSON(heatmapMap, selectedCountry);



		});


	});

	function filterDropdownItems(input, itemClass) {
		const value = input.value.toLowerCase();
		const items = document.getElementsByClassName(itemClass);

		for (let i = 0; i < items.length; i++) {
			const item = items[i];
			const itemName = item.textContent.toLowerCase();

			if (itemName.includes(value)) {
				item.style.display = "block";
			} else {
				item.style.display = "none";
			}
		}
	}

	/* TOUT CE QUI CONCERNE L'ENVOI D'UN COMMENTAIRE*/


	// Liste de classes de couleur prédéfinies
	var colorClasses = ["bg-primary", "bg-secondary", "bg-info", "bg-success", "bg-danger", "bg-warning"];

	// Fonction pour choisir une couleur aléatoire
	function getRandomColor() {
		var randomIndex = Math.floor(Math.random() * colorClasses.length);
		return colorClasses[randomIndex];
	}

	// Appliquer une couleur aléatoire à tous les éléments avec la classe "random-color"
	$(".random-color").each(function () {
		var randomColor = getRandomColor();
		$(this).addClass(randomColor);
	});

	// Obtenez une référence au bouton et au formulaire
	var postButton = document.getElementById("postButton");
	var commentForm = document.getElementById("commentForm");
	var cancelButton = document.getElementById("cancelButton");


	document.getElementById('submitCommentBtn').addEventListener('click', function () {
		// Récupérer le texte du commentaire et le CSRF token
		var commentText = document.getElementById('commentText').value;
		var csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;

		// Créer un objet de données pour envoyer via AJAX
		var data = new FormData();
		data.append('text', commentText);
		data.append('csrfmiddlewaretoken', csrfToken);

		// Envoyer le commentaire via AJAX
		fetch("{% url 'home' %}", {
			method: 'POST',
			body: data,
			headers: {
				'X-CSRFToken': csrfToken,
				'X-Requested-With': 'XMLHttpRequest' // Indiquer que c'est une requête AJAX
			}
		})
			.then(response => response.json())
			.then(data => {
				console.log(data.message);

				// Mettez à jour la liste des commentaires dans l'interface utilisateur
				const commentsContainer = document.querySelector(".card-body.comment");
				const updatedComment = `
            <!-- Nouveau commentaire -->
				<div class="d-flex mb-2">
					<!-- Avatar de l'utilisateur -->
					<div class="avatar avatar-online">
						<span class="avatar-title rounded-circle border border-white random-color">
							${data.comment_user.username.slice(0, 1)}
						</span>
					</div>
					<!-- Contenu du commentaire -->
					<div class="flex-1 ml-3 pt-1">
						<h6 class="text-uppercase fw-bold mb-1">
							${data.comment_user.username}
							${data.comment_user.first_name}
							${data.comment_user.last_name}
						</h6>
						<span class="text-muted">${commentText}</span>
					</div>
					<!-- Heure du commentaire -->
					<div class="float-right pt-1">
						<small class="text-muted">Maintenant</small>
					</div>	
				</div>
            <div class="separator-dashed"></div>
        `;

				// Ajouter le nouveau commentaire à la fin de la liste des commentaires
				//commentsContainer.innerHTML += updatedComment;
				commentsContainer.insertAdjacentHTML("afterbegin", updatedComment);

				// Masquer le formulaire et afficher à nouveau le bouton "Post"
				commentForm.classList.add("hidden-form");
				postButton.style.display = "block";
			})
			.catch(error => {
				console.error("Erreur lors de l'envoi du commentaire:", error);
			});
	});


	// Ajoutez un événement de clic au bouton
	postButton.addEventListener("click", function () {
		// Basculez la visibilité du formulaire en ajoutant ou en supprimant la classe "hidden-form"
		commentForm.classList.toggle("hidden-form");
		postButton.style.display = "none"; // Masquez le bouton "Post"
	});

	cancelButton.addEventListener("click", function () {
		// Réinitialisez la visibilité du formulaire et du bouton "Post"
		commentForm.classList.add("hidden-form");
		postButton.style.display = "block";
	});
	const commentSearchInput = document.getElementById("commentSearch");
	const commentsContainer = document.getElementById("commentsContainer");
	const originalCommentsHTML = commentsContainer.innerHTML;
	const commentEntries = commentsContainer.querySelectorAll(".comment-entry");

	commentSearchInput.addEventListener("input", function () {
		const searchText = commentSearchInput.value.toLowerCase();

		let filteredCommentsHTML = "";

		commentEntries.forEach(function (entry) {
			const commentText = entry.textContent.toLowerCase();
			const shouldDisplay = commentText.includes(searchText);

			if (shouldDisplay) {
				filteredCommentsHTML += entry.outerHTML;
			}
		});

		if (filteredCommentsHTML === "") {
			commentsContainer.innerHTML = "No matching comments found.";
		} else {
			commentsContainer.innerHTML = filteredCommentsHTML;
		}

		console.log("Je t'aime Ruru");
	});

	// Réinitialiser les commentaires à leur état initial
	function resetComments() {
		commentsContainer.innerHTML = originalCommentsHTML;
	}

	commentSearchInput.addEventListener("focus", function () {
		resetComments();
	});



	/*--------------------------------------CODE--TANIA----------------------------------------------------*/


	const barCanvas = document.getElementById("barCanvas");

	const barChart3 = new Chart(barCanvas,
		{
			type: "bar",
			data: {
				labels: ["202207", "202208", "202209", "202210", "202211", "202212", "202301", "202302", "202303", "202304", "202305", "202306", "202307"],
				datasets: [
					{
						label: 'Total Events',
						data: [282, 794, 990, 1061, 790, 720, 1029, 911, 1225, 1109, 997, 1001, 587],
						backgroundColor: [
							"#FEFEE0",//ecru
							"#FEFEE0",//ecru
							"#FEFEE0",//ecru
							"#FEFEE0",//ecru
							"#FEFEE0",//ecru
							"#FEFEE0",//ecru
							"#FEFEE0",//ecru
							"#FEFEE0",//ecru
							"#FEFEE0",//ecru
							"#FEFEE0",//ecru
							"#FEFEE0",//ecru
							"#FEFEE0",//ecru
							"#FEFEE0",//ecru
							"#FEFEE0",//ecru
							"#FEFEE0",//ecru
						]
					}
				]
			},
			options: {
				scales: {
					y: {
						title: {
							display: true,
							text: 'Total Events'

						},
						suggestedMax: 1300,
					},
					x: {
						ticks: {
							font: {
								style: "italic"
							},
							maxRotation: 45, // Angle d'inclinaison, ajustez selon vos besoins
							minRotation: 45

						}
					}
				}
			}
		})




	const EventTypeCanvas = document.getElementById("EventTypeCanvas");

	function ValeurWithK(value) {
		if (value > 1000) {
			return (value / 1000) + 'k';
		} else {
			return value;
		}
	}

	function getEventTypeLabel(context) {
		var labelIndex = context.dataIndex;
		var labels = context.chart.data.labels;
		return 'Event type: ' + labels[labelIndex];
	}

	function getTotalEventLabel(context) {
		var value = context.parsed.y || 0;
		return 'Total events: ' + value;
	}

	const options = {
		plugins: {
			tooltip: {
				callbacks: {
					label: function (context) {
						return [getEventTypeLabel(context), getTotalEventLabel(context)];
					}
				}
			},
		},
		scales: {
			y: {
				title: {
					display: true,
					text: 'Total Events'
				},
				suggestedMax: 800000,
				ticks: {
					callback: function (value) {
						return ValeurWithK(value);
					}
				}
			},
			x: {
				title: {
					display: true,
					text: 'Event Type(icon)'
				},
				ticks: {
					callback: function (value) {
						let label = this.getLabelForValue(value);
						if (label.length > 11) {
							return label.substr(0, 11) + "...";
						} else {
							return label;
						}
					}
				},
			},
		},
	};

	const barChart2 = new Chart(EventTypeCanvas, {
		type: "bar",
		data: {
			labels: ["\u{1F4E2}|Protests", "\u{1F4A5}|Battles", "\u{1F4A3}|Explosions/remote violences", "\u{1F469}|Violence against civilians", "\u{1F680}|Strategic developments", "\u{270A}|Riots"],
			datasets: [{
				label: "Events per Type & Subtype",
				data: [282010, 794000, 990000, 1061000, 790000, 720010],
				backgroundColor: [
					"#00FFFF",
					"#FFFF00",
					"#D473D4",
					"#FFC961",
					"#7A238A",
					"#FA8072",
				],
				hoverBackgroundColor: [
					"#00CCCC",
					"#FFD700",
					"#C25CC2",
					"#E6B035",
					"#641B6B",
					"#E9967A",
				],
				borderColor: [], // Leave this empty for default border color
				borderWidth: 1, // Initial border width
			}],
		},
		options: options,
	});

	var selectedBars = []; // Tableau pour stocker les indices des barres sélectionnées
	const originalBackgroundColor = barChart2.data.datasets[0].backgroundColor.slice();
	const originalBorderColor = barChart2.data.datasets[0].borderColor.slice();

	EventTypeCanvas.onclick = function (event) {
		const activeBars = barChart2.getElementsAtEventForMode(event, 'index', { intersect: true });

		if (activeBars.length > 0) {
			const clickedIndex = activeBars[0].index;

			// Vérifier si la barre est déjà sélectionnée
			const selectedIndex = selectedBars.indexOf(clickedIndex);
			if (selectedIndex !== -1) {
				// La barre est déjà sélectionnée, donc la désélectionner
				selectedBars.splice(selectedIndex, 1);
			} else {
				// La barre n'est pas déjà sélectionnée, donc l'ajouter à la sélection
				selectedBars.push(clickedIndex);
			}

			// Mettre à jour les couleurs et les bordures en fonction des barres sélectionnées
			for (let i = 0; i < barChart2.data.datasets[0].backgroundColor.length; i++) {
				if (selectedBars.includes(i)) {
					barChart2.data.datasets[0].backgroundColor[i] = originalBackgroundColor[i];
					barChart2.data.datasets[0].borderColor[i] = "#000000"; // Black border for selected bar
					barChart2.data.datasets[0].borderWidth[i] = 3;
				} else {
					barChart2.data.datasets[0].backgroundColor[i] = lightenColor(originalBackgroundColor[i], 40);
					barChart2.data.datasets[0].borderColor[i] = originalBackgroundColor[i]; // Reset border color for unselected bar
					barChart2.data.datasets[0].borderWidth[i] = 1; // Reset border width
				}
			}

			barChart2.update();
		}
	};

	document.addEventListener('click', function (event) {
		if (!EventTypeCanvas.contains(event.target)) {
			selectedBars = []; // Réinitialiser la sélection
			for (let i = 0; i < barChart2.data.datasets[0].backgroundColor.length; i++) {
				barChart2.data.datasets[0].backgroundColor[i] = originalBackgroundColor[i];
				barChart2.data.datasets[0].borderColor[i] = originalBackgroundColor[i]; // Reset border color
				barChart2.data.datasets[0].borderWidth[i] = 1; // Reset border width
			}

			barChart2.update();
		}
	});

	// Fonction pour rendre une couleur plus claire
	function lightenColor(color, percent) {
		const num = parseInt(color.slice(1), 16);
		const amt = Math.round(2.55 * percent);
		const R = (num >> 16) + amt;
		const G = (num >> 8 & 0x00FF) + amt;
		const B = (num & 0x0000FF) + amt;
		return `#${(0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 + (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 + (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1)}`;
	}


	
	$(document).ready(function () {

var dropdownContainer = $('#dropdown-options');
var searchBar = $('#search-bar');
searchBar.on('input', function () {
	var query = $(this).val().toLowerCase();

	var found = false; // Variable pour suivre si des résultats ont été trouvés

	dropdownContainer.find('.dropdown-item').each(function () {
		var itemText = $(this).text().toLowerCase();

		if (itemText.includes(query)) {
			$(this).show();
			found = true; // Au moins un résultat a été trouvé
		} else {
			$(this).hide();
		}
	});

	// Afficher "Aucun résultat trouvé" si aucun résultat n'a été trouvé
	if (!found) {
		dropdownContainer.append($('<div class="dropdown-item">no results found</div>'));
	}
});

function showCard() {
	$('#event-card').show(); // Afficher la div avec l'identifiant event-card
}
$('[data-toggle="dropdown"]').dropdown();
function formatEventDate(rawDate) {
	var eventDate = new Date(rawDate);
	var options = { day: 'numeric', month: 'long', year: 'numeric' };
	return eventDate.toLocaleDateString('en-US', options);
}

function applySearchFilter(query, data) {
	return data.filter(function (item) {
		return item.notes.includes(query);
	});
}

var activityFeed = $('#activity-feed');
var searchInput = $('#search-input');


$.ajax({
	url: window.location.href,
	method: 'GET',
	dataType: 'json',
	success: function (data) {
		var dropdownContainer = $('#dropdown-options'); // Sélectionner le conteneur spécifique

		// Générer les éléments de la liste déroulante à partir des données reçues
		data.forEach(function (item) {
			var optionLink = $('<a>', {
				// href: '#',
				class: 'dropdown-item',
				css: {
					color: 'black',
					overflow: 'hidden',
					whiteSpace: 'normal', // Permettre au texte de passer à la ligne
					wordWrap: 'break-word', // Permettre le passage à la ligne
					maxWidth: '100%' // Limiter la largeur pour éviter que le texte dépasse le conteneur
				},
				text: item.notes
			});
			optionLink.on('click', function () {
				$('#event-card').hide(); // Masquer la div avec l'identifiant event-card

				// Insère le nouveau contenu dans le conteneur "replace"
				var newContent = `
						<div class="card full-height" id="replace">
							<!-- Le contenu de la nouvelle div ici -->
								<div class="card-header">
									<div class="card-title">
										<div class="card-title">
											<div class="row align-items-center">
												<div class="col-md-10">
													<span style="font-weight: bold;">Event Description</span>
												</div>
												<div class="col-md-2">
													<button id="transparent-button" class="btn btn-default">Last Event</button>

												</div>

											</div>
										</div>

									</div>
									<div class="card-body-scroll">
										<div class="container mt-5" >
											<div style="color: white;">	
												${item.notes}<br>
												<br>
												<span style="font-weight: bold;">date: </span>${item.event_date}<br>
												<br>
												<span style="font-weight: bold;">Country: </span>${item.country}<br>
												<br>
												<span style="font-weight: bold;">type: </span>${item.type}<br>
												<br>
												<span style="font-weight: bold;">source: </span>${item.source}<br>
												<br>
												<span style="font-weight: bold;">fatalities: </span>${item.fatalities}<br>
												<br>
											</div>
										</div>
									</div>
								</div>
							`;

				$('#replace').html(newContent);

				// Ajoutez la gestion d'événement de clic pour le bouton transparent
				$('#transparent-button').on('click', function () {
					showCard(); // Réapparition de la div
				});

			});
			dropdownContainer.append(optionLink);
		});

		dropdownContainer.css({
			width: '450px',
			height: '300px',
			overflow: 'auto'
		});

		var types = ['success', 'info', 'warning', 'danger'];

		function updateFeed(query) {
			activityFeed.empty();

			var filteredData = applySearchFilter(query, data);

			for (var i = 0; i < filteredData.length; i++) {
				if (filteredData[i].notes.trim() === '') {
					continue;
				}

				var listItem = $('<li></li>').addClass('feed-item').addClass('feed-item-' + types[i % types.length]);

				var formattedDate = formatEventDate(filteredData[i].event_date);
				var time = $('<time class="date"></time>').text(formattedDate);
				listItem.append(time);

				var text = filteredData[i].notes;
				var span = $('<span class="text" style="color:white"></span>').text(text);
				listItem.append(span);
				activityFeed.append(listItem);
			}
		}

		updateFeed('');

		searchInput.on('input', function () {
			var query = $(this).val();
			updateFeed(query);
		});
	},

	error: function (error) {
		console.log('Une erreur s\'est produite :', error);
	}
});

});



// Fonction pour afficher directement le calendrier dès que la fenêtre modale s'affiche
$('#myModal').on('shown.bs.modal', function () {
$('#dateRangePicker1, #dateRangePicker2').datepicker({
	format: 'dd/mm/yyyy',
	autoclose: true,
	todayHighlight: true,
});
});

// Ouvrir la fenêtre modale lors du clic sur l'élément "Option 3"
$('#openModal').click(function () {
$('#myModal').modal('show');
// Vider les valeurs des inputs du calendrier lors de l'ouverture de la fenêtre modale
$('#dateRangePicker1, #dateRangePicker2').val('');
});

// Fonction pour enregistrer les dates sélectionnées lorsque le bouton "Appliquer" est cliqué
$('#btnApply').click(function () {
var startDate = $('#dateRangePicker1').datepicker('getDate');
var endDate = $('#dateRangePicker2').datepicker('getDate');
});




















</script>

{% endblock javascripts %}