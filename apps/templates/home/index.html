{% extends "layouts/base.html" %}

{% block title %} Dashboard {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

{% load static %}

<div class="content">
	<div class="panel-header bg-primary-gradient">
		<div class="page-inner py-5">
			<div class="d-flex align-items-left align-items-md-center flex-column flex-md-row">
				<!--<div>
						<h2 class="text-white pb-2 fw-bold">Dashboard</h2>
						<h5 class="text-white op-7 mb-2">Free Bootstrap 4 Admin Dashboard</h5>
					</div>
					<div class="ml-md-auto py-2 py-md-0">
						<a href="#" class="btn btn-white btn-border btn-round mr-2">Manage</a>
						<a href="#" class="btn btn-secondary btn-round">Add Customer</a>
					</div>-->
			</div>
		</div>
	</div>
	<div class="row row-card-no-pd">
		<div class="col-md-12">
			<div class="card">
				<div class="card-header">
					<div class="card-head-row card-tools-still-right">
						<h4 class="card-title">Users Geolocation</h4>
						<div class="card-tools">
							<div class="row">
								<div class="col">
									<div class="dropdown show">
										<a class="btn btn-success dropdown-toggle" href="#" role="button"
											id="continentDropdownButton" data-toggle="dropdown" aria-haspopup="true"
											aria-expanded="false">
											Select a continent
										</a>

										<div class="dropdown-menu" aria-labelledby="continentDropdownButton"
											id="continentDropdown">

											{% for continent in continentsData.continents %}
											<a class="dropdown-item continent-item" href="#"
												data-value="{{ continent.name }}">{{ continent.name }}</a>
											{% endfor %}


										</div>
									</div>
								</div>
								<div class="col">

									<div class="dropdown show" id="regionDropdownContainer" style="display: none;">
										<a class="btn btn-success dropdown-toggle" href="#" role="button"
											id="regionDropdownButton" data-toggle="dropdown" aria-haspopup="true"
											aria-expanded="false">
											Select a region
										</a>

										<div class="dropdown-menu" aria-labelledby="regionDropdownButton"
											id="regionDropdown">
											<!-- This will be populated with regions based on the selected continent -->
										</div>
									</div>
								</div>
								<div class="col">
									<!-- Menu déroulant des pays avec barre de recherche -->
									<div class="dropdown show" id="countryDropdownContainer" style="display: none;">
										<a class="btn btn-success dropdown-toggle" href="#" role="button"
											id="countryDropdownButton" data-toggle="dropdown" aria-haspopup="true"
											aria-expanded="false">
											Select a country
										</a>

										<div class="dropdown-menu" aria-labelledby="countryDropdownButton"
											id="countryDropdown">



											<!-- Liste des pays -->
											<!-- This will be populated with countries based on the selected region -->
										</div>
									</div>
								</div>

							</div>

						</div>
					</div>
					<a class="btn btn-info btn-border btn-round btn-sm mr-2" id="HeatmapBtn">
						<span class="btn-label">
							<i class="fa fa-pencil"></i>
						</span>
						Chaleur
					</a>
					<a class="btn btn-info btn-border btn-round btn-sm mr-2" id="BasemapBtn">
						<span class="btn-label">
							<i class="fa fa-pencil"></i>
						</span>
						Normal
					</a>
				</div>
				<div class="card-body">
					<div class="row">
						<div class="col-md-6">
							<div class="mapcontainer">
								<div id="map" style="width: 1180px; height: 500px;"></div>
								<div id="heatmapMap" style="width: 1180px; height: 500px; display: none;"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<br>
	<div class="page-inner mt--5">
		<div class="row mt--2">
			<div class="col-md-6">
				<div class="card full-height">
					<div class="card-body">
						<div class="card-title">Overall statistics</div>
						<div class="card-category">Daily information about statistics in system</div>
						<div class="d-flex flex-wrap justify-content-around pb-2 pt-4">
							<div class="px-2 pb-2 pb-md-0 text-center">
								<div id="circles-1"></div>
								<h6 class="fw-bold mt-3 mb-0">New Users</h6>
							</div>
							<div class="px-2 pb-2 pb-md-0 text-center">
								<div id="circles-2"></div>
								<h6 class="fw-bold mt-3 mb-0">Sales</h6>
							</div>
							<div class="px-2 pb-2 pb-md-0 text-center">
								<div id="circles-3"></div>
								<h6 class="fw-bold mt-3 mb-0">Subscribers</h6>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-6">
				<div class="card full-height">
					<div class="card-body">
						<div class="card-title">Total income & spend statistics</div>
						<div class="row py-3">
							<div class="col-md-4 d-flex flex-column justify-content-around">
								<div>
									<h6 class="fw-bold text-uppercase text-success op-8">Total Income</h6>
									<h3 class="fw-bold">$9.782</h3>
								</div>
								<div>
									<h6 class="fw-bold text-uppercase text-danger op-8">Total Spend</h6>
									<h3 class="fw-bold">$1,248</h3>
								</div>
							</div>
							<div class="col-md-8">
								<div id="chart-container">
									<canvas id="totalIncomeChart"></canvas>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-8">
				<div class="card">
					<div class="card-header">
						<div class="card-head-row">
							<div class="card-title">Event per Countries</div>
							<div class="card-tools">
								<a class="btn btn-info btn-border btn-round btn-sm mr-2" id="perCountryBtn">
									<span class="btn-label">
										<i class="fa fa-pencil"></i>
									</span>
									per Country
								</a>
								<a class="btn btn-info btn-border btn-round btn-sm mr-2" id="perPeriodBtn">
									<span class="btn-label">
										<i class="fa fa-pencil"></i>
									</span>
									per Period
								</a>
								<a class="btn btn-info btn-border btn-round btn-sm mr-2" id="perTypeSubtypeBtn">
									<span class="btn-label">
										<i class="fa fa-pencil"></i>
									</span>
									per Type&Subtype
								</a>
							</div>
						</div>
					</div>
					<div class="card-body">
						<div class="chart-container">
							<canvas id="barChart"></canvas>
							<canvas id="lineChart" style="display:none;"></canvas>
							<canvas id="bubbleChart" style="display:none;"></canvas>
						</div>

					</div>
				</div>
			</div>
			<div class="col-md-4 custom-height">
				<div class="card card-primary bg-primary-gradient">
					<div class="card-body d-flex flex-column">
						<h4 class="mt-3 b-b1 pb-2 mb-4 fw-bold">Pays</h4>
						<h1 class="mb-4 fw-bold">17</h1>
						<h4 class="mt-3 b-b1 pb-2 mb-5 fw-bold">Details Incidents</h4>
						<h4 class="mt-5 pb-3 mb-0 fw-bold">08h46-11h57</h4>
						<ul class="list-unstyled">
							<li class="d-flex justify-content-between pb-1 pt-1">
								<small>Morts</small> <span>0</span>
							</li>
							<li class="d-flex justify-content-between pb-1 pt-1">
								<small>Blessés</small> <span>38</span>
							</li>
							<li class="d-flex justify-content-between pb-1 pt-1">
								<small>Sains</small> <span>88</span>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-4">
				<div class="card">
					<div class="card-header">
						<div class="card-title">Top Products</div>
					</div>
					<div class="card-body pb-0">
						<div class="d-flex">
							<div class="avatar">
								<img src="/static/assets/img/logoproduct.svg" alt="..."
									class="avatar-img rounded-circle">
							</div>
							<div class="flex-1 pt-1 ml-2">
								<h6 class="fw-bold mb-1">CSS</h6>
								<small class="text-muted">Cascading Style Sheets</small>
							</div>
							<div class="d-flex ml-auto align-items-center">
								<h3 class="text-info fw-bold">+$17</h3>
							</div>
						</div>
						<div class="separator-dashed"></div>
						<div class="d-flex">
							<div class="avatar">
								<img src="/static/assets/img/logoproduct.svg" alt="..."
									class="avatar-img rounded-circle">
							</div>
							<div class="flex-1 pt-1 ml-2">
								<h6 class="fw-bold mb-1">J.CO Donuts</h6>
								<small class="text-muted">The Best Donuts</small>
							</div>
							<div class="d-flex ml-auto align-items-center">
								<h3 class="text-info fw-bold">+$300</h3>
							</div>
						</div>
						<div class="separator-dashed"></div>
						<div class="d-flex">
							<div class="avatar">
								<img src="/static/assets/img/logoproduct3.svg" alt="..."
									class="avatar-img rounded-circle">
							</div>
							<div class="flex-1 pt-1 ml-2">
								<h6 class="fw-bold mb-1">Ready Pro</h6>
								<small class="text-muted">Bootstrap 4 Admin Dashboard</small>
							</div>
							<div class="d-flex ml-auto align-items-center">
								<h3 class="text-info fw-bold">+$350</h3>
							</div>
						</div>
						<div class="separator-dashed"></div>
						<div class="pull-in">
							<canvas id="topProductsChart"></canvas>
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-4">
				<div class="card">
					<div class="card-body">
						<div class="card-title fw-mediumbold">Suggested People</div>
						<div class="card-list">
							<div class="item-list">
								<div class="avatar">
									<img src="/static/assets/img/jm_denis.jpg" alt="..."
										class="avatar-img rounded-circle">
								</div>
								<div class="info-user ml-3">
									<div class="username">Jimmy Denis</div>
									<div class="status">Graphic Designer</div>
								</div>
								<button class="btn btn-icon btn-primary btn-round btn-xs">
									<i class="fa fa-plus"></i>
								</button>
							</div>
							<div class="item-list">
								<div class="avatar">
									<img src="/static/assets/img/chadengle.jpg" alt="..."
										class="avatar-img rounded-circle">
								</div>
								<div class="info-user ml-3">
									<div class="username">Chad</div>
									<div class="status">CEO Zeleaf</div>
								</div>
								<button class="btn btn-icon btn-primary btn-round btn-xs">
									<i class="fa fa-plus"></i>
								</button>
							</div>
							<div class="item-list">
								<div class="avatar">
									<img src="/static/assets/img/talha.jpg" alt="..." class="avatar-img rounded-circle">
								</div>
								<div class="info-user ml-3">
									<div class="username">Talha</div>
									<div class="status">Front End Designer</div>
								</div>
								<button class="btn btn-icon btn-primary btn-round btn-xs">
									<i class="fa fa-plus"></i>
								</button>
							</div>
							<div class="item-list">
								<div class="avatar">
									<img src="/static/assets/img/mlane.jpg" alt="..." class="avatar-img rounded-circle">
								</div>
								<div class="info-user ml-3">
									<div class="username">John Doe</div>
									<div class="status">Back End Developer</div>
								</div>
								<button class="btn btn-icon btn-primary btn-round btn-xs">
									<i class="fa fa-plus"></i>
								</button>
							</div>
							<div class="item-list">
								<div class="avatar">
									<img src="/static/assets/img/talha.jpg" alt="..." class="avatar-img rounded-circle">
								</div>
								<div class="info-user ml-3">
									<div class="username">Talha</div>
									<div class="status">Front End Designer</div>
								</div>
								<button class="btn btn-icon btn-primary btn-round btn-xs">
									<i class="fa fa-plus"></i>
								</button>
							</div>
							<div class="item-list">
								<div class="avatar">
									<img src="/static/assets/img/jm_denis.jpg" alt="..."
										class="avatar-img rounded-circle">
								</div>
								<div class="info-user ml-3">
									<div class="username">Jimmy Denis</div>
									<div class="status">Graphic Designer</div>
								</div>
								<button class="btn btn-icon btn-primary btn-round btn-xs">
									<i class="fa fa-plus"></i>
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-4">
				<div class="card card-primary">
					<div class="card-header">
						<div class="card-title">Daily Sales</div>
						<div class="card-category">March 25 - April 02</div>
					</div>
					<div class="card-body pb-0">
						<div class="mb-4 mt-2">
							<h1>$4,578.58</h1>
						</div>
						<div class="pull-in">
							<canvas id="dailySalesChart"></canvas>
						</div>
					</div>
				</div>
				<div class="card">
					<div class="card-body pb-0">
						<div class="h1 fw-bold float-right text-warning">+7%</div>
						<h2 class="mb-2">213</h2>
						<p class="text-muted">Transactions</p>
						<div class="pull-in sparkline-fix">
							<div id="lineChart"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-6">
				<div class="card full-height">
					<div class="card-header">
						<div class="card-title">Feed Activity</div>
					</div>
					<div class="card-body">
						<ol class="activity-feed">
							<li class="feed-item feed-item-secondary">
								<time class="date" datetime="9-25">Sep 25</time>
								<span class="text">Responded to need <a href="#">"Volunteer opportunity"</a></span>
							</li>
							<li class="feed-item feed-item-success">
								<time class="date" datetime="9-24">Sep 24</time>
								<span class="text">Added an interest <a href="#">"Volunteer Activities"</a></span>
							</li>
							<li class="feed-item feed-item-info">
								<time class="date" datetime="9-23">Sep 23</time>
								<span class="text">Joined the group <a href="single-group.php">"Boardsmanship
										Forum"</a></span>
							</li>
							<li class="feed-item feed-item-warning">
								<time class="date" datetime="9-21">Sep 21</time>
								<span class="text">Responded to need <a href="#">"In-Kind Opportunity"</a></span>
							</li>
							<li class="feed-item feed-item-danger">
								<time class="date" datetime="9-18">Sep 18</time>
								<span class="text">Created need <a href="#">"Volunteer Opportunity"</a></span>
							</li>
							<li class="feed-item">
								<time class="date" datetime="9-17">Sep 17</time>
								<span class="text">Attending the event <a href="single-event.php">"Some New
										Event"</a></span>
							</li>
						</ol>
					</div>
				</div>
			</div>
			<div class="col-md-6">
				<div class="card full-height">
					<div class="card-header">
						<div class="card-head-row">
							<div class="card-title">Support Tickets</div>
							<div class="card-tools">
								<ul class="nav nav-pills nav-secondary nav-pills-no-bd nav-sm" id="pills-tab"
									role="tablist">
									<li class="nav-item">
										<a class="nav-link" id="pills-today" data-toggle="pill" href="#pills-today"
											role="tab" aria-selected="true">Today</a>
									</li>
									<li class="nav-item">
										<a class="nav-link active" id="pills-week" data-toggle="pill" href="#pills-week"
											role="tab" aria-selected="false">Week</a>
									</li>
									<li class="nav-item">
										<a class="nav-link" id="pills-month" data-toggle="pill" href="#pills-month"
											role="tab" aria-selected="false">Month</a>
									</li>
								</ul>
							</div>
						</div>
					</div>
					<!-- Boucle pour afficher les commentaires -->
					
					<div class="card-body">
						{% for comment in comments %}
						<div class="d-flex mb-2">
							<!-- Avatar de l'utilisateur -->
							<div class="avatar avatar-online">
								<span class="avatar-title rounded-circle border border-white bg-info">{{ comment.get_username|first }}</span>
							</div>
							<!-- Contenu du commentaire -->
							<div class="flex-1 ml-3 pt-1">
								<h6 class="text-uppercase fw-bold mb-1">{{ comment.get_username }} {{ comment.user_id.first_name }} {{ comment.user_id.last_name }}</h6>
								<span class="text-muted">{{ comment.text }}</span>
							</div>
							<!-- Heure du commentaire -->
							<div class="float-right pt-1">
								<small class="text-muted">{{ comment.date|date:"h:i A" }}</small>
							</div>
						</div>
						<div class="separator-dashed"></div>
						{% endfor %}
					</div>
					

					<!-- Affichez le formulaire pour poster un commentaire -->
					<form id="commentForm" method="post">
						{% csrf_token %}
						<textarea id="commentText" name="text" class="form-control" rows="3"
							placeholder="Write a comment..."></textarea>
						<button id="postCommentBtn" type="button" class="btn btn-primary mt-3">Post Comment</button>
					</form>

				</div>
			</div>
		</div>
	</div>
</div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

<!-- Atlantis DEMO methods, don't include it in your project! -->
<script src="/static/assets/js/setting-demo.js"></script>
<script src="/static/assets/js/demo.js"></script>
<script src="https://api.mapbox.com/mapbox-gl-js/v2.5.1/mapbox-gl.js"></script>
<script src="https://unpkg.com/mapbox-gl@2.4.1/dist/mapbox-gl.js"></script>



<link href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css" rel="stylesheet" />
<link rel="stylesheet" href="https://unpkg.com/mapbox-gl@2.4.1/dist/mapbox-gl.css" />


<style>
	/* CSS personnalisé pour afficher la liste des pays en dessous du bouton */
	.dropdown-menu {
		max-height: 200px;
		overflow-y: auto;
		/*top: 100% !important;
		margin-top: 171px !important;*/
	}

	.dropdown-menu .dropdown-item {
		/* Retirez ou désactivez la règle de filter */
		/* filter: blur(2px); */
		/* Ou réglez la valeur sur none */
		filter: none;
	}

	.chart-container {
		height: 350px;
	}

	.custom-height {
		height: 350px;
	}
</style>

<script>
	Circles.create({
		id: 'circles-1',
		radius: 45,
		value: 60,
		maxValue: 100,
		width: 7,
		text: 5,
		colors: ['#f1f1f1', '#FF9E27'],
		duration: 400,
		wrpClass: 'circles-wrp',
		textClass: 'circles-text',
		styleWrapper: true,
		styleText: true
	})

	Circles.create({
		id: 'circles-2',
		radius: 45,
		value: 70,
		maxValue: 100,
		width: 7,
		text: 36,
		colors: ['#f1f1f1', '#2BB930'],
		duration: 400,
		wrpClass: 'circles-wrp',
		textClass: 'circles-text',
		styleWrapper: true,
		styleText: true
	})

	Circles.create({
		id: 'circles-3',
		radius: 45,
		value: 40,
		maxValue: 100,
		width: 7,
		text: 12,
		colors: ['#f1f1f1', '#F25961'],
		duration: 400,
		wrpClass: 'circles-wrp',
		textClass: 'circles-text',
		styleWrapper: true,
		styleText: true
	})

	var totalIncomeChart = document.getElementById('totalIncomeChart').getContext('2d');

	var mytotalIncomeChart = new Chart(totalIncomeChart, {
		type: 'bar',
		data: {
			labels: ["S", "M", "T", "W", "T", "F", "S", "S", "M", "T"],
			datasets: [{
				label: "Total Income",
				backgroundColor: '#ff9e27',
				borderColor: 'rgb(23, 125, 255)',
				data: [6, 4, 9, 5, 4, 6, 4, 3, 8, 10],
			}],
		},
		options: {
			responsive: true,
			maintainAspectRatio: false,
			legend: {
				display: false,
			},
			scales: {
				yAxes: [{
					ticks: {
						display: false //this will remove only the label
					},
					gridLines: {
						drawBorder: false,
						display: false
					}
				}],
				xAxes: [{
					gridLines: {
						drawBorder: false,
						display: false
					}
				}]
			},
		}
	});

	$('#lineChart').sparkline([105, 103, 123, 100, 95, 105, 115], {
		type: 'line',
		height: '70',
		width: '100%',
		lineWidth: '2',
		lineColor: '#ffa534',
		fillColor: 'rgba(255, 165, 52, .14)'
	});

	var lineChart = document.getElementById('lineChart').getContext('2d'),
		bubbleChart = document.getElementById('bubbleChart').getContext('2d')


	var myLineChart = new Chart(lineChart, {
		type: 'line',
		data: {
			labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
			datasets: [{
				label: "Active Users",
				borderColor: "#1d7af3",
				pointBorderColor: "#FFF",
				pointBackgroundColor: "#1d7af3",
				pointBorderWidth: 2,
				pointHoverRadius: 4,
				pointHoverBorderWidth: 1,
				pointRadius: 4,
				backgroundColor: 'transparent',
				fill: true,
				borderWidth: 2,
				data: [542, 480, 430, 550, 530, 453, 380, 434, 568, 610, 700, 900]
			}]
		},
		options: {
			responsive: true,
			maintainAspectRatio: false,
			legend: {
				position: 'bottom',
				labels: {
					padding: 10,
					fontColor: '#1d7af3',
				}
			},
			tooltips: {
				bodySpacing: 4,
				mode: "nearest",
				intersect: 0,
				position: "nearest",
				xPadding: 10,
				yPadding: 10,
				caretPadding: 10
			},
			layout: {
				padding: { left: 15, right: 15, top: 15, bottom: 15 }
			}
		}
	});

	var myBubbleChart = new Chart(bubbleChart, {
		type: 'bubble',
		data: {
			datasets: [{
				label: "Car",
				data: [{ x: 25, y: 17, r: 25 }, { x: 30, y: 25, r: 28 }, { x: 35, y: 30, r: 8 }],
				backgroundColor: "#716aca"
			},
			{
				label: "Motorcycles",
				data: [{ x: 10, y: 17, r: 20 }, { x: 30, y: 10, r: 7 }, { x: 35, y: 20, r: 10 }],
				backgroundColor: "#1d7af3"
			}],
		},
		options: {
			responsive: true,
			maintainAspectRatio: false,
			legend: {
				position: 'bottom'
			},
			scales: {
				yAxes: [{
					ticks: {
						beginAtZero: true
					}
				}],
				xAxes: [{
					ticks: {
						beginAtZero: true
					}
				}]
			},
		}
	});


	// Gérer le clic sur le bouton "per Country"
	$("#perCountryBtn").on("click", function () {
		// Afficher le graphique "barChart" et masquer les autres graphiques
		$("#barChart").show();
		$("#lineChart").hide();
		$("#bubbleChart").hide();
	});

	// Gérer le clic sur le bouton "per Period"
	$("#perPeriodBtn").on("click", function () {
		// Afficher le graphique "lineChart" et masquer les autres graphiques
		$("#barChart").hide();
		$("#lineChart").show();
		$("#bubbleChart").hide();
	});

	// Gérer le clic sur le bouton "per Type&Subtype"
	$("#perTypeSubtypeBtn").on("click", function () {
		// Afficher le graphique "bubbleChart" et masquer les autres graphiques
		$("#barChart").hide();
		$("#lineChart").hide();
		$("#bubbleChart").show();
	});

	// Afficher le graphique "barChart" par défaut
	$("#barChart").show();



	// Masquer la carte de chaleur et afficher la carte de base
	/*document.querySelector('.mapcontainer #heatmapMap').style.display = 'none';
	document.querySelector('.mapcontainer #map').style.display = 'block';*/


	// Gérer le clic sur le bouton "per Country"
	$("#BasemapBtn").on("click", function () {
		// Afficher le graphique "barChart" et masquer les autres graphiques
		$("#map").show();
		$("#heatmapMap").hide();
	});

	// Afficher le graphique "barChart" par défaut
	$("#map").show();




	mapboxgl.accessToken = 'pk.eyJ1IjoidHJpZ2dlcnMiLCJhIjoiY2wxMjNxYmkwMDM2ZjNpbXZvMXNqaXRwcyJ9.CPlAR38urDrvZeJOIUERIw';
	var map = new mapboxgl.Map({
		container: 'map',
		style: 'mapbox://styles/mapbox/streets-v11',
		center: [-5.5471, 7.5468545], // Remplacez par les coordonnées du centre de votre carte
		zoom: 5,// Niveau de zoom initial
		maxZoom: 15
	});


	var heatmapMap = new mapboxgl.Map({
		container: 'heatmapMap',
		style: 'mapbox://styles/mapbox/light-v10',
		center: [-5.5471, 7.5468545], // Remplacez par les coordonnées du centre de votre carte
		zoom: 5,// Niveau de zoom initial
		maxZoom: 15
	});

	var geolocateControl = new mapboxgl.GeolocateControl({ // Utilisation de this.geolocateControl
		positionOptions: {
			enableHighAccuracy: true
		},
		trackUserLocation: true,
		showUserHeading: true
	});

	var geolocateHeatControl = new mapboxgl.GeolocateControl({ // Utilisation de this.geolocateControl
		positionOptions: {
			enableHighAccuracy: true
		},
		trackUserLocation: true,
		showUserHeading: true
	});

	map.addControl(this.geolocateControl, 'top-left');
	heatmapMap.addControl(this.geolocateHeatControl, 'top-left');

	var heatmapData = [
		{ lng: 13.404954, lat: 52.520008, value: 0.6 }, // Berlin, Germany
		{ lng: 2.352222, lat: 48.856614, value: 0.7 }, // Paris, France
		{ lng: -0.180525, lat: 51.404818, value: 0.9 }, // London, United Kingdom
		{ lng: 4.351710, lat: 50.850340, value: 0.8 }, // Brussels, Belgium
		{ lng: 12.496366, lat: 41.902782, value: 0.4 }, // Rome, Italy
		{ lng: 31.235712, lat: 30.044420, value: 0.3 }, // Cairo, Egypt
		{ lng: 2.173403, lat: 41.385064, value: 0.5 }, // Barcelona, Spain
		{ lng: 32.585179, lat: 15.500654, value: 0.2 }, // Khartoum, Sudan
		{ lng: 35.689506, lat: 139.691700, value: 0.7 }, // Tokyo, Japan
		{ lng: 25.276987, lat: -25.731340, value: 0.6 }, // Johannesburg, South Africa
		{ lng: 5.603717, lat: 52.076665, value: 0.8 }, // Amsterdam, Netherlands
		{ lng: -8.629105, lat: 41.157944, value: 0.4 }, // Porto, Portugal
		// Ajoutez plus de points avec leurs coordonnées et valeurs ici
	];



	heatmapMap.on('load', function () {
		// Ajouter la couche de chaleur à la carte de chaleur
		heatmapMap.addLayer({
			id: 'heatmapLayer',
			type: 'heatmap',
			source: {
				type: 'geojson',
				data: {
					type: 'FeatureCollection',
					features: heatmapData.map(point => ({
						type: 'Feature',
						geometry: {
							type: 'Point',
							coordinates: [point.lng, point.lat]
						},
						properties: {
							value: point.value
						}
					}))
				}
			},
			paint: {
				'heatmap-radius': 20,
				'heatmap-color': [
					'interpolate',
					['linear'],
					['heatmap-density'],
					0, 'rgba(33,102,172,0)',
					0.2, 'rgb(103,169,207)',
					0.4, 'rgb(209,229,240)',
					0.6, 'rgb(253,219,199)',
					0.8, 'rgb(239,138,98)',
					1, 'rgb(178,24,43)'
				],
				'heatmap-opacity': 0.75
			}
		});
	});

	document.getElementById('HeatmapBtn').addEventListener('click', function () {
		// Masquer la carte existante et afficher la carte de chaleur
		document.querySelector('.mapcontainer #map').style.display = 'none';
		document.querySelector('.mapcontainer #heatmapMap').style.display = 'block';

		// Redimensionner la carte de chaleur pour s'adapter à la taille du conteneur
		heatmapMap.resize();
	});





	// Déclarez la variable continentsData en dehors de la fonction loadJSON
	let continentsData

	// Fonction pour charger les données JSON depuis pays.json via une requête AJAX
	function loadJSON(callback) {
		const xhr = new XMLHttpRequest();
		xhr.overrideMimeType("application/json");
		xhr.open("GET", "{% static 'json/pays.json' %}", true);
		xhr.onreadystatechange = function () {
			if (xhr.readyState === 4 && xhr.status === 200) {
				continentsData = JSON.parse(xhr.responseText);
				callback(continentsData); // Appelez la fonction de rappel avec les données JSON en tant qu'argument
			}
		};
		xhr.send(null);
	}

	let selectedMarker;
	// Utilisez la fonction loadJSON pour récupérer les données JSON
	loadJSON(function (data) {
		// Ici, vous pouvez utiliser les données JSON récupérées
		console.log(data);

		// Placez le reste de votre code ici, en utilisant les données JSON

		// Récupérer les éléments des menus déroulants
		// Récupérer les éléments des menus déroulants
		const continentDropdown = $("#continentDropdown");
		const regionDropdownContainer = $("#regionDropdownContainer");
		const regionDropdown = $("#regionDropdown");
		const countryDropdownContainer = $("#countryDropdownContainer");
		const countryDropdown = $("#countryDropdown");

		// Gérer le changement de sélection dans le menu déroulant des continents
		continentDropdown.on("click", ".continent-item", function (e) {
			e.preventDefault();

			// Récupérer le continent sélectionné
			const selectedContinent = $(this).data("value");

			// Afficher le continent sélectionné dans le bouton du menu déroulant
			$("#continentDropdownButton").text(selectedContinent);

			// Masquer le menu déroulant des pays
			countryDropdownContainer.hide();
			countryDropdown.empty();

			// Masquer le menu déroulant des régions (au cas où l'utilisateur change de continent)
			regionDropdownContainer.hide();
			regionDropdown.empty();

			// Récupérer les régions du continent sélectionné
			const regions = data.continents.find(continent => continent.name === selectedContinent).regions;

			// Remplir le menu déroulant des régions
			regions.forEach(region => {
				const optionElement = `<a class="dropdown-item region-item" href="#" data-value="${region.name}">${region.name}</a>`;
				regionDropdown.append(optionElement);
			});

			// Afficher le menu déroulant des régions
			regionDropdownContainer.show();
		});


		var dataChart = {
			labels: [], // Utilisez les noms des pays comme valeurs de l'axe des ordonnées
			datasets: [{
				label: "Incidents",
				backgroundColor: 'rgb(23, 125, 255)',
				borderColor: 'rgb(23, 125, 255)',
				data: [], // Utilisez les valeurs des incidents comme données pour le graphique à barres
			}]
		};

		var options = {
			responsive: true,
			maintainAspectRatio: false,
			scales: {
				xAxes: [{
					ticks: {
						beginAtZero: true
					}
				}]
			},
		};

		var myBarChart = new Chart(barChart, {
			type: 'horizontalBar', // Utilisez le type horizontalBar pour avoir un histogramme horizontal
			data: dataChart,
			options: options

		});

		// Gérer le changement de sélection dans le menu déroulant des régions
		regionDropdown.on("click", ".region-item", function (e) {
			e.preventDefault();

			// Récupérer la région sélectionnée
			const selectedRegion = $(this).data("value");

			// Afficher la région sélectionnée dans le bouton du menu déroulant
			$("#regionDropdownButton").text(selectedRegion);

			// Masquer le menu déroulant des pays (au cas où l'utilisateur change de région)
			countryDropdownContainer.hide();
			countryDropdown.empty();

			// Récupérer les pays de la région sélectionnée
			const continent = data.continents.find(continent => continent.name === $("#continentDropdownButton").text());
			const countries = continent.regions.find(region => region.name === selectedRegion).countries;

			// Créer l'élément de la barre de recherche
			const searchInputElement = $('<input type="text" class="form-control search-input" placeholder="Search country...">')

				.css({
					"border-top": "0px",
					"border-bottom": "3px solid gray",
					"border-left": "0px",
					"border-right": "0px",
					"background": "white",
					"border-radius": "25px",
					"color": "black",
					"height": "40px",
				})
				// Ajouter l'événement onkeyup à la barre de recherche
				.on("keyup", function () {
					filterDropdownItems(this, 'country-item');
				});

			// Ajouter la barre de recherche au début du dropdown-menu des pays
			countryDropdown.prepend(searchInputElement);

			// Remplir le menu déroulant des pays
			countries.forEach(country => {
				const optionElement = `<a class="dropdown-item country-item" href="#" data-value="${country.name}" data-lat="${country.latitude}" data-lon="${country.longitude}">${country.name}</a>`;
				countryDropdown.append(optionElement);
			});


			// Afficher le menu déroulant des pays
			countryDropdownContainer.show();

			// Mettre à jour l'objet "data" avec les valeurs des pays et des incidents
			const countryNames = countries.map(country => country.name);
			const incidentValues = countries.map(country => Math.floor(Math.random() * 100)); // Valeurs aléatoires entre 0 et 100
			myBarChart.data.labels = countryNames;
			myBarChart.data.datasets[0].data = incidentValues;
			myBarChart.update(); // Mettre à jour le graphique


		});

		countryDropdown.on("click", ".country-item", function (e) {
			e.preventDefault();

			// Récupérer le pays sélectionné
			const selectedCountry = $(this).data("value");
			const lat = $(this).data("lat");
			const lon = $(this).data("lon");

			// Afficher le pays sélectionné dans le bouton du menu déroulant
			$("#countryDropdownButton").text(selectedCountry);

			// Déplacer la carte Mapbox pour centrer le pays sélectionné
			map.flyTo({ center: [lon, lat], zoom: 5 });

			heatmapMap.flyTo({ center: [lon, lat], zoom: 5 });


			function loadCountryGeoJSON(map, countryName) {
				// Charger les données GeoJSON des contours du pays ici
				// Remplacez 'path/to/' par le chemin vers le dossier contenant les fichiers GeoJSON de chaque pays
				const geoJSONPath = `/static/geojson/${countryName}.geojson`;

				// Vérifier si la source de données existe déjà
				const sourceExists = map.getSource('countries');

				if (sourceExists) {
					// Mettre à jour la source de données existante avec le nouveau fichier GeoJSON
					map.getSource('countries').setData(geoJSONPath);
				} else {
					// Ajouter une nouvelle source de données pour le pays sélectionné
					map.addSource('countries', {
						type: 'geojson',
						data: geoJSONPath,
					});

					// Ajouter une couche de remplissage pour le pays
					map.addLayer({
						id: 'country-fill',
						type: 'fill',
						source: 'countries',
						paint: {
							'fill-color': 'blue', // Couleur de remplissage des pays
							'fill-opacity': 0.5, // Opacité de remplissage
						},
					});

					// Ajouter une couche de contour pour le pays
					/*map.addLayer({
						id: 'country-outline',
						type: 'line',
						source: 'countries',
						paint: {
							'line-color': 'red', // Couleur des contours des pays
							'line-width': 1, // Epaisseur des contours
						},
					});*/
				}
			}

			loadCountryGeoJSON(map, selectedCountry);
			loadCountryGeoJSON(heatmapMap, selectedCountry);



		});


	});

	function filterDropdownItems(input, itemClass) {
		const value = input.value.toLowerCase();
		const items = document.getElementsByClassName(itemClass);

		for (let i = 0; i < items.length; i++) {
			const item = items[i];
			const itemName = item.textContent.toLowerCase();

			if (itemName.includes(value)) {
				item.style.display = "block";
			} else {
				item.style.display = "none";
			}
		}
	}

	/* TOUT CE QUI CONCERNE L'ENVOI D'UN COMMENTAIRE*/

	document.getElementById('postCommentBtn').addEventListener('click', function () {
		// Récupérer le texte du commentaire et le CSRF token
		var commentText = document.getElementById('commentText').value;
		var csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value;

		// Créer un objet de données pour envoyer via AJAX
		var data = new FormData();
		data.append('text', commentText);
		data.append('csrfmiddlewaretoken', csrfToken);

		// Envoyer le commentaire via AJAX
		fetch("{% url 'home' %}", {
			method: 'POST',
			body: data,
			headers: {
				'X-CSRFToken': csrfToken,
				'X-Requested-With': 'XMLHttpRequest' // Indiquer que c'est une requête AJAX
			}
		})
			.then(response => response.json())
			.then(data => {
				console.log(data.message);
				// Actualiser la liste des commentaires sans recharger la page (c'est un exemple, vous devez implémenter cette partie)
			})
			.catch(error => {
				console.error("Erreur lors de l'envoi du commentaire:", error);
			});
	});

















</script>

{% endblock javascripts %}